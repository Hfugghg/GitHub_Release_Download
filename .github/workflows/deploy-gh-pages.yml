# å·¥ä½œæµåç§°
name: Build and Deploy to GitHub Pages

# å·¥ä½œæµè§¦å‘å™¨
on:
  # å˜æ›´ 1: åªåœ¨ main åˆ†æ”¯æœ‰ push æ“ä½œæ—¶è§¦å‘
  push:
    branches:
      - main

  # å…è®¸åœ¨ GitHub Actions é¡µé¢æ‰‹åŠ¨è§¦å‘æ­¤å·¥ä½œæµ
  workflow_dispatch:

permissions:
  contents: write
  pages: write
  id-token: write

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      # æ­¥éª¤ 1: æ£€å‡º main åˆ†æ”¯çš„ä»£ç 
      # è¿™æ˜¯ä½ çš„ç½‘ç«™æ¡†æ¶
      - name: Checkout main branch ğŸ›ï¸
        uses: actions/checkout@v4
        with:
          ref: main

      # å˜æ›´ 2: ç§»é™¤äº†æ£€å‡º gallery-data å’Œåˆå¹¶æ–‡ä»¶çš„æ­¥éª¤
      # å› ä¸ºç°åœ¨ä¸¤ä¸ªå·¥ä½œæµç›´æ¥æ“ä½œ gh-pages åˆ†æ”¯

      # æ­¥éª¤ 2 (åŸæ­¥éª¤ 4): éƒ¨ç½²åˆ° gh-pages åˆ†æ”¯
      - name: Deploy to gh-pages branch ğŸš€
        uses: peaceiris/actions-gh-pages@v4
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          # å˜æ›´ 3: ä¸å†éœ€è¦æŒ‡å®š publish_dirï¼Œé»˜è®¤ä¸ºå½“å‰ç›®å½•
          # publish_dir: ./public
          publish_branch: gh-pages

          # å˜æ›´ 4 (å…³é”®): ä¿ç•™ç›®æ ‡åˆ†æ”¯ä¸­ä¸å±äºæœ¬æ¬¡éƒ¨ç½²çš„æ–‡ä»¶
          # è¿™ä¼šé˜²æ­¢ assets æ–‡ä»¶å¤¹è¢«åˆ é™¤
          keep_files: true

          # (å¯é€‰) è‡ªå®šä¹‰æäº¤ä¿¡æ¯
          commit_message: "Deploy: Update site from main branch"